{% extends "base.html" %}

{% block content %}
    <h1>Ajouter une carte</h1>
    
    <div class="add-card-container">
        <form method="post" id="add-card-form">
            <div>
                <label for="set_id">Série (ex: A1, A2a):</label>
                <select id="set_id" name="set_id" required>
                    <option value="A1">A1 (Puissance Génétique)</option>
                    <option value="A2a">A1a (Ile Fabuleuse)</option>
                    <option value="A2b">A2 (Choc Spatio-Temporelle)</option>
                    <option value="A2c">A2a (Lumière Triomphale)</option>
                </select>
            </div>
            <div>
                <label for="card_number">Numéro de carte:</label>
                <input type="number" id="card_number" name="card_number" required>
            </div>
            <div>
                <label>Type:</label>
                <div class="radio-group">
                    <div>
                        <input type="radio" id="extra" name="card_type" value="extra" checked>
                        <label for="extra">J'ai cette carte en trop</label>
                    </div>
                    <div>
                        <input type="radio" id="wanted" name="card_type" value="wanted">
                        <label for="wanted">Je recherche cette carte</label>
                    </div>
                </div>
            </div>
            <div>
                <button type="button" id="preview-button">Prévisualiser</button>
                <button type="submit">Ajouter</button>
            </div>
        </form>
        
        <div id="card-preview" class="card-preview" style="display: none;">
            <h3>Prévisualisation:</h3>
            <div class="card-item">
                <div class="card-image">
                    <img id="preview-image" src="" alt="Prévisualisation">
                </div>
                <h3 id="preview-title"></h3>
            </div>
        </div>
    </div>
    
    <script>
        document.getElementById('preview-button').addEventListener('click', function() {
            const setId = document.getElementById('set_id').value;
            const cardNumber = document.getElementById('card_number').value;
            
            if (!setId || !cardNumber) {
                alert('Veuillez entrer une série et un numéro de carte.');
                return;
            }
            
            // Faire une requête pour obtenir les informations de la carte
            fetch(`/card_info?set_id=${setId}&card_number=${cardNumber}`)
                .then(response => response.json())
                .then(data => {
                    if (data.exists) {
                        document.getElementById('preview-image').src = data.image_url;
                        document.getElementById('preview-title').textContent = 
                            `${data.set_id}-${data.card_number}: ${data.french_name || data.card_name}`;
                        document.getElementById('card-preview').style.display = 'block';
                    } else {
                        alert('Carte non trouvée dans la base de données.');
                    }
                })
                .catch(error => {
                    console.error('Erreur:', error);
                    alert('Erreur lors de la recherche de la carte.');
                });
        });
    </script>
    
    <style>
        .add-card-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .card-preview {
            padding: 20px;
            background-color: #f5f5f5;
            border-radius: 8px;
        }
        
        .radio-group {
            margin: 10px 0;
        }
        
        .radio-group div {
            margin-bottom: 8px;
        }
        
        @media (max-width: 768px) {
            .add-card-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
{% endblock %} 